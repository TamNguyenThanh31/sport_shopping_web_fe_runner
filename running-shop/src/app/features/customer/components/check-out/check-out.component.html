<div class="checkout-container">
  <h2>Thanh toán</h2>
  <p-table [value]="cartItems" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th>Sản phẩm</th>
        <th>Kích thước</th>
        <th>Màu sắc</th>
        <th>Số lượng</th>
        <th>Giá</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>
          <img [src]="item.imageUrl" width="50" alt="Sản phẩm" />
          {{ item.productName }}
        </td>
        <td>{{ item.size }}</td>
        <td>{{ item.color }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.totalPrice | currency:'VND' }}</td>
      </tr>
    </ng-template>
  </p-table>

  <div class="summary">
    <p>Tạm tính: {{ subtotal | currency:'VND' }}</p>
    <p>Giảm giá: {{ discount | currency:'VND' }}</p>
    <p>Tổng cộng: {{ total | currency:'VND' }}</p>
  </div>

  <div class="address">
    <p>Địa chỉ: {{ selectedAddress ? selectedAddress.fullName + ', ' + selectedAddress.addressLine + ', ' + selectedAddress.city : 'Chưa chọn' }}</p>
    <p-button label="Chọn địa chỉ" (click)="showAddressDialog = true" />
    <p-dialog header="Chọn địa chỉ" [(visible)]="showAddressDialog" [modal]="true" [style]="{ 'width': '50vw' }">
      <p-table [value]="addresses">
        <ng-template pTemplate="header">
          <tr>
            <th>Họ tên</th>
            <th>Số điện thoại</th>
            <th>Địa chỉ</th>
            <th>Thành phố</th>
            <th>Mặc định</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-address>
          <tr>
            <td>{{ address.fullName }}</td>
            <td>{{ address.phone }}</td>
            <td>{{ address.addressLine }}</td>
            <td>{{ address.city }}</td>
            <td>{{ address.isDefault ? 'Có' : '' }}</td>
            <td><p-button label="Chọn" (click)="selectAddress(address)" /></td>
          </tr>
        </ng-template>
      </p-table>
    </p-dialog>
  </div>

  <div class="promotion">
    <p>Mã giảm giá: {{ selectedPromotion ? selectedPromotion.code : 'Chưa chọn' }}</p>
    <p-button label="Chọn mã" (click)="showPromotionDialog = true" />
    <p-dialog header="Chọn mã giảm giá" [(visible)]="showPromotionDialog" [modal]="true" [style]="{ 'width': '50vw' }">
      <p-table [value]="promotions">
        <ng-template pTemplate="header">
          <tr>
            <th>Mã</th>
            <th>Giảm giá</th>
            <th>Giá trị tối thiểu</th>
            <th>Hết hạn</th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-promo>
          <tr>
            <td>{{ promo.code }}</td>
            <td>{{ promo.discountPercentage }}%</td>
            <td>{{ promo.minimumOrderValue ? (promo.minimumOrderValue | currency:'VND') : 'Không' }}</td>
            <td>{{ promo.endDate ? (promo.endDate | date) : 'Không' }}</td>
            <td><p-button label="Áp dụng" (click)="applyPromotion(promo)" /></td>
          </tr>
        </ng-template>
      </p-table>
    </p-dialog>
  </div>

  <div class="payment-method">
    <p-radioButton name="paymentMethod" value="VNPAY" [(ngModel)]="paymentMethod" label="VnPay" />
    <p-radioButton name="paymentMethod" value="CASH_ON_DELIVERY" [(ngModel)]="paymentMethod" label="Thanh toán khi nhận hàng" />
  </div>

  <p-button label="Đặt hàng" (click)="placeOrder()" />
</div>
<p-toast />
