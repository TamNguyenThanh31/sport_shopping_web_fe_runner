<div class="container-fluid mt-4" style="margin-top: 60px">
  <div class="grid">
    <!-- Sidebar: Danh mục -->
    <div class="col-12 md:col-3">
      <p-listbox
        [options]="categories"
        [(ngModel)]="selectedCategory"
        optionLabel="name"
        (onChange)="filterByCategory()"
        styleClass="w-full"
        [listStyle]="{ 'max-height': '300px' }">
        <ng-template pTemplate="item" let-category>
          <div class="flex justify-content-between align-items-center">
            <span>{{ category.name }}</span>
            <p-badge
              [value]="categoryProductCounts[category.id] || '0'"
              styleClass="ml-2"
              severity="info">
            </p-badge>
          </div>
        </ng-template>
      </p-listbox>
    </div>

    <!-- Danh sách sản phẩm -->
    <div class="col-12 md:col-9">
      <p-toast></p-toast>
      <p-dataView [value]="filteredProducts" [layout]="layout">
      <ng-template pTemplate="header">
          <div class="flex justify-content-between align-items-center">
            <h2>Danh sách sản phẩm</h2>
            <p-dropdown
              [options]="[{ label: 'Grid', value: 'grid' }, { label: 'List', value: 'list' }]"
              [(ngModel)]="layout"
              styleClass="w-10rem">
            </p-dropdown>
          </div>
        </ng-template>
        <ng-template let-product pTemplate="gridItem">
          <div class="col-12 sm:col-6 md:col-4 p-2">
            <p-card [header]="product.name" [subheader]="product.brand" styleClass="shadow-2">
              <img [src]="product.images[0]?.imageUrl || 'https://via.placeholder.com/300'"
                   [alt]="product.name"
                   class="w-full"
                   style="height: 200px; object-fit: cover;">
              <p class="mt-2">{{ product.description?.substring(0, 50) || 'Không có mô tả' }}...</p>
              <p class="mt-2 font-bold text-red-600">{{ product.variants[0]?.price || 'N/A' }} USD</p>
              <ng-template pTemplate="footer">
                <div class="flex gap-2">
                  <p-button
                    label="Xem chi tiết"
                    icon="pi pi-eye"
                    styleClass="p-button-outlined p-button-sm"
                    [routerLink]="['/customer/detail-product', product.id]">
                  </p-button>
                  <p-button
                    label="Thêm vào giỏ"
                    icon="pi pi-cart-plus"
                    styleClass="p-button-sm"
                    (click)="addToCart(product)">
                  </p-button>
                </div>
              </ng-template>
            </p-card>
          </div>
        </ng-template>
        <ng-template let-product pTemplate="listItem">
          <div class="col-12 p-2">
            <p-card styleClass="shadow-2">
              <div class="flex align-items-center">
                <img [src]="product.images[0]?.imageUrl || 'https://via.placeholder.com/150'"
                     [alt]="product.name"
                     class="mr-3"
                     style="width: 100px; height: 100px; object-fit: cover;">
                <div class="flex-1">
                  <h3>{{ product.name }}</h3>
                  <p class="text-600">{{ product.brand }}</p>
                  <p>{{ product.description?.substring(0, 100) || 'Không có mô tả' }}...</p>
                  <p class="font-bold text-red-600">{{ product.variants[0]?.price || 'N/A' }} USD</p>
                </div>
                <div class="flex gap-2">
                  <p-button
                    label="Xem chi tiết"
                    icon="pi pi-eye"
                    styleClass="p-button-outlined p-button-sm"
                    [routerLink]="['/customer/detail-product', product.id]">
                  </p-button>
                  <p-button
                    label="Thêm vào giỏ"
                    icon="pi pi-cart-plus"
                    styleClass="p-button-sm"
                    (click)="addToCart(product)">
                  </p-button>
                </div>
              </div>
            </p-card>
          </div>
        </ng-template>
        <ng-template pTemplate="empty">
          <div class="text-center p-4">
            <p class="text-600">Không có sản phẩm nào trong danh mục này.</p>
          </div>
        </ng-template>
      </p-dataView>
    </div>
  </div>
</div>
