<div class="management-container">
  <div *ngIf="!displayDetail" class="content-wrapper">
    <div class="header-section">
      <div class="title-group">
        <h2>{{type === 'customer' ? 'Customer' : 'Staff'}} Management</h2>
        <p class="subtitle">Manage your {{type === 'customer' ? 'customers' : 'staff members'}} efficiently</p>
      </div>
      <p-button
        label="Add New"
        icon="pi pi-plus"
        (click)="showDialog()"
        styleClass="add-button">
      </p-button>
    </div>

    <div class="card table-card">
      <div class="table-responsive-wrapper">
        <p-table
          [value]="users"
          [loading]="loading"
          [responsive]="true"
          [scrollable]="true"
          scrollHeight="flex"
          styleClass="p-datatable-striped p-datatable-gridlines">
          <ng-template pTemplate="header">
            <tr>
              <th style="min-width: 80px">ID</th>
              <th>Username</th>
              <th>Email</th>
              <th style="min-width: 180px">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-user>
            <tr>
              <td class="user-id" data-label="ID">{{user.id}}</td>
              <td class="username" data-label="Username">
                <span class="mobile-label">Username:</span>
                {{user.username}}
              </td>
              <td class="email" data-label="Email">
                <span class="mobile-label">Email:</span>
                {{user.email}}
              </td>
              <td class="actions" data-label="Actions">
                <div class="action-buttons">
                  <button pButton pRipple
                          icon="pi pi-pencil"
                          class="p-button-rounded p-button-text p-button-plain edit-btn"
                          pTooltip="Edit" tooltipPosition="top"
                          (click)="showDialog(user)"></button>
                  <button pButton pRipple
                          icon="pi pi-trash"
                          class="p-button-rounded p-button-text p-button-plain delete-btn"
                          pTooltip="Delete" tooltipPosition="top"
                          (click)="deleteUser(user.id)"></button>
                  <button pButton pRipple
                          icon="pi pi-eye"
                          class="p-button-rounded p-button-text p-button-plain detail-btn"
                          pTooltip="Details" tooltipPosition="top"
                          (click)="showDetail(user.id)"></button>
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="4" class="empty-message">
                <i class="pi pi-info-circle"></i>
                No {{type === 'customer' ? 'customers' : 'staff members'}} found
              </td>
            </tr>
          </ng-template>
        </p-table>
        <p-paginator
          [first]="first"
          [rows]="rows"
          [totalRecords]="totalRecords"
          [rowsPerPageOptions]="[5, 10, 25]"
          (onPageChange)="onPageChange($event)"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
        </p-paginator>
      </div>
    </div>
  </div>

  <!-- User Form Dialog -->
  <p-dialog
    header="{{selectedUserId ? 'Edit' : 'Add New'}} {{type === 'customer' ? 'Customer' : 'Staff'}}"
    [(visible)]="displayDialog"
    [modal]="true"
    [style]="{ width: 'min(90vw, 500px)' }"
    [draggable]="false"
    [resizable]="false"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }">
    <form [formGroup]="userForm" (ngSubmit)="saveUser()" class="user-form">
      <div class="form-group">
        <label for="username">Username *</label>
        <input pInputText id="username" formControlName="username" type="text" placeholder="Enter username" />
        <small *ngIf="userForm.get('username')?.touched && userForm.get('username')?.errors" class="error-message">
          <span *ngIf="userForm.get('username')?.hasError('required')">Username is required</span>
        </small>
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input pInputText id="email" formControlName="email" type="email" placeholder="Enter email" />
        <small *ngIf="userForm.get('email')?.touched && userForm.get('email')?.errors" class="error-message">
          <span *ngIf="userForm.get('email')?.hasError('required')">Email is required</span>
          <span *ngIf="userForm.get('email')?.hasError('email')">Invalid email format</span>
        </small>
      </div>

      <div class="form-group">
        <label for="password">Password {{selectedUserId ? '' : '*'}}</label>
        <p-password
          id="password"
          formControlName="password"
          [toggleMask]="true"
          [feedback]="false"
          placeholder="Enter password"
          [inputStyleClass]="'w-full'">
        </p-password>
        <small *ngIf="userForm.get('password')?.touched && userForm.get('password')?.errors" class="error-message">
          <span *ngIf="userForm.get('password')?.hasError('required')">Password is required</span>
          <span *ngIf="userForm.get('password')?.hasError('minlength')">Password must be at least 6 characters</span>
        </small>
      </div>

      <div class="form-actions">
        <button pButton
                type="button"
                label="Cancel"
                class="p-button-outlined cancel-btn"
                (click)="displayDialog = false"></button>
        <button pButton
                type="submit"
                label="Save"
                class="save-btn"
                [disabled]="userForm.invalid"></button>
      </div>
    </form>
  </p-dialog>

  <!-- User Detail Dialog -->
  <p-dialog
    header="User Details"
    [(visible)]="displayDetail"
    [modal]="true"
    [style]="{ width: 'min(90vw, 500px)' }"
    [draggable]="false"
    [resizable]="false"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }">
    <div *ngIf="userDetail" class="user-detail">
      <div class="detail-item">
        <span class="detail-label">ID:</span>
        <span class="detail-value">{{userDetail.id}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Username:</span>
        <span class="detail-value">{{userDetail.username}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Email:</span>
        <span class="detail-value">{{userDetail.email}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Role:</span>
        <span class="detail-value role-badge" [ngClass]="userDetail.role.toLowerCase()">{{userDetail.role}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Created:</span>
        <span class="detail-value">{{userDetail.createdAt | date:'medium'}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Updated:</span>
        <span class="detail-value">{{userDetail.updatedAt | date:'medium'}}</span>
      </div>

      <div class="detail-actions">
        <button pButton
                label="Close"
                class="close-btn"
                (click)="closeDetail()"></button>
      </div>
    </div>
  </p-dialog>

  <p-toast position="top-right"></p-toast>
  <p-confirmDialog [style]="{width: 'min(90vw, 400px)'}"></p-confirmDialog>
</div>
