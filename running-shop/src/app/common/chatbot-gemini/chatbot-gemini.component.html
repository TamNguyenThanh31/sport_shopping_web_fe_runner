<button class="chatbot-toggle-button" (click)="toggleVisible()">
  ðŸ’¬
</button>

<div class="chat-popup" *ngIf="visible" (click)="onMaskClick()">
  <div class="chat-header" (click)="$event.stopPropagation()">
    <span>Chatbot AI</span>
    <button class="close-btn" (click)="toggleVisible()">âœ–</button>
  </div>
  <div class="chat-body" (click)="$event.stopPropagation()">
    <div *ngFor="let item of history">
      <div [class.bot-message]="item.role==='model'" [class.user-message]="item.role==='user'">
        <div class="message-text" [innerHTML]="item.parts[0].text"></div>
        <img *ngIf="item.parts[0].attachment"
             [src]="sanitizer.bypassSecurityTrustUrl('data:image/*;base64,'+item.parts[0].attachment)"
             class="attachment-output" />
      </div>
    </div>
    <div *ngIf="loading" class="loading-indicator">...</div>
  </div>
  <div class="chat-footer" (click)="$event.stopPropagation()">
    <textarea [(ngModel)]="message" rows="2" placeholder="Nháº­p tin nháº¯n..."></textarea>
    <button class="emoji-btn" (click)="toggleEmojiPicker()">ðŸ˜Š</button>
    <input type="file" hidden #fileInput (change)="onFileChange($event)" />
    <button class="attach-btn" (click)="fileInput.click()">ðŸ“Ž</button>
    <button *ngIf="attachmentUrl" class="remove-attach-btn" (click)="removeAttachment()">âœ–</button>
    <button class="send-btn" (click)="send()" [disabled]="loading">âž¤</button>
<!--    <emoji-picker *ngIf="showEmojiPicker"></emoji-picker>-->
  </div>
</div>
