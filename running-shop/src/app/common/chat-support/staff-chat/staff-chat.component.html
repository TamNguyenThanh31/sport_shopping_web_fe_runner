<!-- src/app/features/staff-chat/staff-chat.component.html -->
<div class="staff-chat-container">
  <div class="sidebar">
    <p-panel header="Session Chờ" styleClass="session-panel">
      <ul class="session-list">
        <li *ngFor="let sess of waitingSessions"
            (click)="selectSession(sess, true)"
            [class.active]="selectedSession?.id === sess.id">
          <div class="session-item">
            <div class="session-info">
              <span class="session-id">#{{ sess.id }}</span>
              <span class="session-preview">{{ sess.lastMessage || 'Không có tin nhắn' }}</span>
            </div>
            <span class="session-time">{{ sess.lastActivity | date:'short' }}</span>
          </div>
        </li>
      </ul>
    </p-panel>
    <p-panel header="Session Của Tôi" styleClass="session-panel">
      <ul class="session-list">
        <li *ngFor="let sess of mySessions"
            (click)="selectSession(sess, false)"
            [class.active]="selectedSession?.id === sess.id">
          <div class="session-item">
            <div class="session-info">
              <span class="session-id">#{{ sess.id }}</span>
              <span class="session-preview">{{ sess.lastMessage || 'Không có tin nhắn' }}</span>
            </div>
            <span class="session-time">{{ sess.lastActivity | date:'short' }}</span>
          </div>
        </li>
      </ul>
    </p-panel>
  </div>

  <div class="chat-area" *ngIf="selectedSession; else noSessionTpl">
    <div class="chat-header">
      <div class="header-content">
        <div class="customer-avatar">
          <img src="assets/images/customer-avatar.png" alt="Customer Avatar" />
          <span class="status-indicator online"></span>
        </div>
        <div class="header-text">
          <div class="customer-text">
            <span class="customer-id">Khách hàng ID: {{ selectedSession.customerId }}</span>
            <span class="session-time">Bắt đầu: {{ selectedSession.startedAt | date:'short' }}</span>
          </div>
        </div>
      </div>
      <button pButton type="button" icon="pi pi-times"
              class="p-button-rounded p-button-text p-button-danger close-button"
              (click)="closeChat()"></button>
    </div>
    <div class="chat-window">
      <div class="messages-container">
        <ng-container *ngIf="messagesWithDate.length; else emptyMsg">
          <ng-container *ngFor="let item of messagesWithDate">
            <div *ngIf="item.isDate" class="date-label">
              <span>{{ item.date | date:'EEEE, dd/MM/yyyy' }}</span>
            </div>
            <div *ngIf="!item.isDate"
                 [ngClass]="{'message-customer': item.msg.senderId !== selectedSession.staffId, 'message-staff': item.msg.senderId === selectedSession.staffId}">
              <div class="message-wrapper">
                <div class="avatar">
                  <img [src]="item.msg.senderId === selectedSession.staffId ? 'assets/images/staff-avatar.png' : 'assets/images/customer-avatar.png'" alt="Avatar" />
                </div>
                <div class="msg-content">
                  <div class="message-header">
                    <span class="sender-name">{{ item.msg.senderId === selectedSession.staffId ? 'Bạn' : 'Khách hàng' }}</span>
                    <span class="timestamp">{{ item.msg.timestamp | date:'shortTime' }}</span>
                  </div>
                  <p class="message-text">{{ item.msg.content }}</p>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
        <ng-template #emptyMsg>
          <div class="empty-message">
            <i class="pi pi-comments" style="font-size: 2rem; margin-right: 8px"></i>
            <div class="empty-text">
              <h3>Chưa có tin nhắn nào</h3>
              <p>Hãy bắt đầu cuộc trò chuyện với khách hàng!</p>
            </div>
          </div>
        </ng-template>
      </div>
      <div class="chat-input">
        <div class="input-wrapper">
          <textarea #messageInput pInputTextarea rows="1"
                    [(ngModel)]="newMessageContent"
                    placeholder="Nhập tin nhắn..."
                    class="message-input"
                    (input)="adjustTextareaHeight($event)"></textarea>
        </div>
        <button class="send-button" (click)="sendMessage()" [disabled]="!newMessageContent.trim()">
          <div class="svg-wrapper-1">
            <div class="svg-wrapper">
              <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h24v24H0z" fill="none"></path>
                <path d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z" fill="currentColor"></path>
              </svg>
            </div>
          </div>
          <span>Gửi</span>
        </button>
      </div>
    </div>
  </div>

  <ng-template #noSessionTpl>
    <div class="no-session">
      <i class="pi pi-comments" style="font-size: 3rem; color: #007AFF;"></i>
      <p>Vui lòng chọn một session để bắt đầu trò chuyện.</p>
    </div>
  </ng-template>
</div>
