<p-card header="Hỗ trợ khách hàng" styleClass="chat-card">
  <ng-container *ngIf="session">
    <div class="chat-header">
      <div class="header-content">
        <div class="staff-avatar" *ngIf="session.staffId">
          <img src="assets/images/staff-avatar.png" alt="Staff Avatar" />
          <span class="status-indicator online"></span>
        </div>
        <div class="header-text">
          <span *ngIf="!session.staffId" class="waiting-text">
            <i class="pi pi-spin pi-spinner" style="font-size: 1rem; margin-right: 8px"></i>
            Đang chờ nhân viên nhận...
          </span>
          <span *ngIf="session.staffId" class="staff-text">
            Nhân viên hỗ trợ
          </span>
        </div>
      </div>
      <button pButton type="button" icon="pi pi-times" class="p-button-rounded p-button-text p-button-danger close-button" (click)="closeChat()"></button>
    </div>
    <p-scrollPanel #scrollPanel styleClass="chat-window" [style]="{'height': 'calc(100vh - 180px)'}">
      <div class="messages-container">
        <ng-container *ngIf="messagesWithDate.length; else emptyMsg">
          <ng-container *ngFor="let item of messagesWithDate">
            <div *ngIf="item.isDate" class="date-label">
              <span>{{ item.date | date:'EEEE, dd/MM/yyyy' }}</span>
            </div>
            <div *ngIf="!item.isDate"
                 [ngClass]="{'message-customer': item.msg.senderId === session.customerId, 'message-staff': item.msg.senderId !== session.customerId}">
              <div class="message-wrapper">
                <div class="avatar">
                  <img [src]="item.msg.senderId === session.customerId ? 'assets/images/customer-avatar.png' : 'assets/images/staff-avatar.png'" alt="Avatar" />
                </div>
                <div class="msg-content">
                  <div class="message-header">
                    <span class="sender-name">{{ item.msg.senderId === session.customerId ? 'Bạn' : 'Nhân viên hỗ trợ' }}</span>
                    <span class="timestamp">{{ item.msg.timestamp | date:'shortTime' }}</span>
                  </div>
                  <p class="message-text">{{ item.msg.content }}</p>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
        <ng-template #emptyMsg>
          <div class="empty-message">
            <i class="pi pi-comments" style="font-size: 2rem; margin-right: 8px"></i>
            <div class="empty-text">
              <h3>Chưa có tin nhắn nào</h3>
              <p>Hãy bắt đầu cuộc trò chuyện với nhân viên hỗ trợ của chúng tôi!</p>
            </div>
          </div>
        </ng-template>
      </div>
    </p-scrollPanel>
    <div class="chat-input">
      <div class="input-wrapper">
        <textarea #messageInput pInputTextarea rows="1" [(ngModel)]="newMessageContent"
                  placeholder="Nhập tin nhắn..." class="message-input"
                  (input)="adjustTextareaHeight($event)"></textarea>
      </div>
      <button class="send-button" (click)="sendMessage()" [disabled]="!newMessageContent.trim()">
        <div class="svg-wrapper-1">
          <div class="svg-wrapper">
            <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 0h24v24H0z" fill="none"></path>
              <path d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z" fill="currentColor"></path>
            </svg>
          </div>
        </div>
        <span>Gửi</span>
      </button>
    </div>
  </ng-container>
  <ng-template #loading>
    <div class="loading-container">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <p>Đang khởi tạo kết nối…</p>
    </div>
  </ng-template>
</p-card>
