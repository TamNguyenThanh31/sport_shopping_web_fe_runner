<p-card [header]="mode === 'add' ? 'Thêm sản phẩm' : mode === 'edit' ? 'Sửa sản phẩm' : 'Chi tiết sản phẩm'">
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
    <!-- Thông tin sản phẩm -->
    <div class="p-field">
      <label for="name">Tên sản phẩm</label>
      <input id="name" pInputText formControlName="name" />
      <small *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="p-error">
        Tên sản phẩm phải có ít nhất 3 ký tự
      </small>
    </div>

    <div class="p-field">
      <label for="description">Mô tả</label>
      <input id="description" pInputText formControlName="description" />
    </div>

    <div class="p-field">
      <label for="categoryId">Danh mục</label>
      <p-select
        id="categoryId"
        [options]="categories"
        formControlName="categoryId"
        optionLabel="name"
        optionValue="id"
        placeholder="Chọn danh mục"
      ></p-select>
      <small *ngIf="productForm.get('categoryId')?.invalid && productForm.get('categoryId')?.touched" class="p-error">
        Vui lòng chọn danh mục
      </small>
    </div>

    <div class="p-field">
      <label for="brand">Thương hiệu</label>
      <input id="brand" pInputText formControlName="brand" />
      <small *ngIf="productForm.get('brand')?.invalid && productForm.get('brand')?.touched" class="p-error">
        Vui lòng nhập thương hiệu
      </small>
    </div>

    <div class="p-field">
      <label for="brand">Kích hoạt</label>
      <p-checkbox formControlName="active" label="Kích hoạt" [binary]="true"></p-checkbox>
    </div>

    <!-- Biến thể -->
    <h3>Biến thể</h3>
    <div formArrayName="variants">
      <div *ngFor="let variant of variants.controls; let i=index" [formGroupName]="i" class="variant-group">
        <input pInputText formControlName="size" placeholder="Kích thước" />
        <input pInputText formControlName="color" placeholder="Màu sắc" />
        <input pInputText type="number" formControlName="stock" placeholder="Tồn kho" />
        <input pInputText type="number" formControlName="price" placeholder="Giá" />
        <input pInputText formControlName="sku" placeholder="SKU" />
        <p-button label="Xóa" (click)="removeVariant(i)" [disabled]="mode === 'view'"></p-button>
      </div>
    </div>
    <p-button label="Thêm biến thể" (click)="addVariant()" [disabled]="mode === 'view'"></p-button>

    <!-- Hình ảnh -->
    <h3>Hình ảnh</h3>
    <p-fileUpload
      (onSelect)="onFileSelect($event)"
      (onRemove)="onFileRemove($event)"
      [multiple]="true"
      [disabled]="mode === 'view'"
    ></p-fileUpload>
    <div formArrayName="images">
      <div *ngFor="let image of images.controls; let i=index" [formGroupName]="i" class="image-group">
        <img
          [src]="getImagePreviewUrl(uploadedImages[i], image.get('imageUrl')?.value)"
          width="100"
          alt="Product image"
        />
        <p-checkbox
          formControlName="isPrimary"
          label="Ảnh chính"
          (onChange)="setPrimaryImage(i)"
          [disabled]="mode === 'view'"
        ></p-checkbox>
        <p-button label="Xóa" (click)="removeImage(i)" [disabled]="mode === 'view'"></p-button>
      </div>
    </div>

    <!-- Nút điều khiển -->
    <div class="p-field">
      <p-button
        type="submit"
        [label]="mode === 'add' ? 'Thêm' : 'Lưu'"
        [disabled]="isLoading || mode === 'view'"
      ></p-button>
      <p-button type="button" label="Hủy" (click)="cancel()"></p-button>
    </div>
  </form>

  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog> <!-- Thêm p-confirmDialog -->
  <p-progressSpinner *ngIf="isLoading"></p-progressSpinner>
</p-card>
